---
workflows:
  basic:
    name: chat_basic
    nodes:
      - module: generation.Simple
        operator: chat

      - module: system.Logger
        operator: acc_stream

  index_local_files:
    name: index_local
    collection: awe_new
    nodes:
      - module: system.Reader
        args:
          path: ./files

      - module: indexing.Simple

  naive_rag:
    name: naive_rag
    collection: hotpot
    nodes:
      - module: retrieval.Semantic
        args:
          top_n: 10

      - module: generation.Augmented
      - module: system.Logger

  rag_rr:
    name: rag_rr
    collection: hotpot
    nodes:
      #- module: pre.QueryTransform

      - module: retrieval.Semantic
        args:
          top_n: 15

      - module: post.Rerank
        args:
          top_n: 10

      - module: generation.Augmented

      - module: system.Logger

  rag_ws:
    name: rag_ws
    collection: hotpot
    nodes:
      - module: pre.QueryTransform

      - module: retrieval.Web
        operator: search
        args:
          top_n: 10
      - module: post.Rerank
        args:
          top_n: 5
      - module: generation.Augmented
      - module: system.Logger

  iter:
    name: iter
    collection: hotpot
    nodes:

      - module: orchestration.Iterate
        type: loop
        args:
          num_iters: 3

        nodes:
          - module: pre.QueryTransform
          - module: retrieval.Web
            args:
              top_n: 20
          - module: post.Rerank
            args:
              top_n: 10

      - module: generation.Augmented
      - module: system.Logger

  qrouter:
    name: qrouter
    collection: hotpot
    nodes:
      - module: orchestration.QueryRoute
        type: conditional
        routes:
          - key: base
            description: Simple queries that do not require any external knowledge and can be directly answered using an LLM's intrinsic knowledge.
            nodes:
              - module: generation.Simple
                operator: chat
          
          - key: web_search
            description: Complex queries that to be answered, require exact information from a web search. 
            nodes:
              - module: retrieval.Web
              - module: generation.Augmented

      - module: system.Logger

  rsplit:
    name: rsplit
    collection: hotpot
    nodes:
      #- module: pre.QueryTransform
      - module: orchestration.Branching
        operator: rrf
        type: branching
        #args:
        #  rrf_k: 15
        #  limit: 4
        branches:
          - name: KB
            nodes:
              - module: retrieval.Semantic
                args:
                  top_n: 15
              - module: post.Rerank
                args:
                  top_n: 5

          - name: WEB
            nodes:
              - module: retrieval.Web
                args:
                  top_n: 15
              - module: post.Rerank
                args:
                  top_n: 5
      - module: generation.Augmented
      - module: system.Logger
